const { SlashCommandBuilder } = require('@discordjs/builders');
const fetch = require('node-fetch')
const { MessageEmbed } = require('discord.js')

module.exports = {
	data: new SlashCommandBuilder()
		.setName('exploit')
		.setDescription('Calcula o exploitas.'),

	async execute(interaction) {
        const formatter = new Intl.NumberFormat();
        const mktRequest = await fetch('https://api.arsha.io/v2/na/item?id=731102&lang=pt')
          .then(res => res.json());

        const bs15 = mktRequest.filter(obj => {
            return obj.sid == 15
        })
        
        const bs15LastSold = formatter.format(bs15[0].lastSoldPrice)
        
        const bsPri = mktRequest.filter(obj => {
            return obj.sid == 16 
        })

        const bsPriLastSold = formatter.format(bsPri[0].lastSoldPrice)
        const profit = formatter.format(bsPri[0].lastSoldPrice - bs15[0].lastSoldPrice)

        const embed = new MessageEmbed()
            .setColor('#0099ff')
            .setTitle('Não incentivamos o exploit')
            .setURL('https://streamable.com/846uqa')
            .setAuthor({
                name: 'OXION INJUSTIÇADA',
                iconURL: 'https://bdocodex.com/items/new_icon/06_pc_equipitem/00_common/01_weapon/00731102.png',
                url: 'https://bdocodex.com/pt/item/731102/#15'
            })
            .setThumbnail('https://bdocodex.com/items/new_icon/06_pc_equipitem/00_common/01_weapon/00731102.png')
            .addFields(
                { name: '\u200B', value: '\u200B'},
                { name: bs15[0].name, value: bs15LastSold.toString(), inline: true },
                { name: bsPri[0].name, value: bsPriLastSold.toString(), inline: true },
                { name: "Diferença", value: profit, inline: true}
            )
            .setImage('https://media.discordapp.net/attachments/886687725703553034/997332050317148190/oxion_logando_no_bdo.gif')
            .setTimestamp()


		return await interaction.reply({ 
			embeds: [embed], 
			ephemeral: true 
		});
	},
};